#!/bin/bash

RESULTS_DIR=$1        # '10-fold-result/fold_3/fold_3_results_win5_sg1/'
CLASSIFICATIONS_DIR="${RESULTS_DIR}/classifications"


# create classification results directory if does not exist
[[ -d ${CLASSIFICATIONS_DIR} ]] || mkdir ${CLASSIFICATIONS_DIR}


# cleanup
rm "${CLASSIFICATIONS_DIR}/"*


for class in 1 2 3 4 5 6
do
        for file in "${RESULTS_DIR}/malware_lang_${class}_"*
        do
                less "${file}" | sed -n "/1_NN/p" | sed -n "s/1_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_1_nn_${class}"
        #        less "${file}" | sed -n "/2_NN/p" | sed -n "s/2_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_2_nn_${class}"
        done
done


for k in 1 2
do
	echo "k  =  ${k}"
	echo
	num_classifications=0
	num_correct=0
	for class in 1 2 3 4 5 6
	do
	        num_classifications_class=0
	        num_correct_class=0
	        for line in `less ${CLASSIFICATIONS_DIR}/classifications_${k}_nn_${class}`
	        do
	                let num_classifications=${num_classifications}+1
	                let num_classifications_class=${num_classifications_class}+1
	                if [ "${line}" = "${class}" ]
	                then
	                        let num_correct=${num_correct}+1
	                        let num_correct_class=${num_correct_class}+1
	                fi
	        done
	        echo "accuracy for class ${class}:"
	        echo "(${num_correct_class}*100)/${num_classifications_class}" | bc -l
	done
	
	echo "number of classifications:"
	echo ${num_classifications}
	echo "number of correct classifications:"
	echo ${num_correct}
	echo
	echo "accuracy:"
	echo "(${num_correct}*100)/${num_classifications}" | bc -l
	echo; echo;
	
done

