#!/bin/bash

DATA="${1-MSACFG}"   # ACFG存放的文件MSACFG
GPU="${2-7}"  # select the GPU number, 0-3
HP_PATH="${3-msacfg.hp}" # full_gpu${GPU}.hp

# general/default settings
gpu_or_cpu=gpu
train_dir=/data/cgh/MS_DATA/train     # 训练数据集.asm的存放路径
use_cached_data=True
cache_path=cached_${DATA,,}_graphs
norm_path=norm_${DATA,,}

CUDA_VISIBLE_DEVICES=${GPU} python cross_valid.py        \
  -seed 1                                                   \
  -data ${DATA}                                             \
  -train_dir ${train_dir}                                   \
  -mode ${gpu_or_cpu}                                       \
  -gpu_id ${GPU}                                            \
  -use_cached_data ${use_cached_data}                       \
  -cache_path ${cache_path}                                 \
  -norm_path ${norm_path}                                   \
  -hp_path ${HP_PATH}

echo "Cross validatation history:"
head -n10 ${DATA}Gpu${GPU}Run0.csv            # 该.csv文件存放最后十倍交叉获得的平均结果



# 实验结果(10-fole-10-fold-per-fold)
# 1、大概每个交叉验证网络训练52分钟
# 2、有55个文件没有边（Skip 55 graphs that have no edge，如：fyH8oWql4rg7tEJSLpIB），skip掉后只剩下总共10813个文件,验证集即1081个
# 3、每个confusion-matrix是在一次交叉验证上做的，对应的pr_scores也是对一次交叉验证来说（相当于9:1分训练集和验证集）
# 4、论文中的实验结果应该就是从十倍交叉验证中拿出一次最好的结果放上去（对应于1081个test data）