# 模块导入
import numpy as np
import pandas as pd
import csv
import os
import sys
import argparse
import random
import tensorflow as tf
import zipfile
from matplotlib import pylab
from six.moves import range
from six.moves.urllib.request import urlretrieve
from sklearn.manifold import TSNE

from tensorboard.plugins import projector

import matplotlib.pyplot as pyplot
import scipy


os.environ['CUDA_VISIBLE_DEVICES'] = '5'


# 获取log中所有.csv文件的名称,不要后缀
def GetTxtName(dir):
    listName = []
    for fileName in os.listdir(dir):
        if os.path.splitext(fileName)[1] == '.csv':
            fileName = os.path.splitext(fileName)[0]
            listName.append(fileName)
    return listName

# list_name 存放所有csv文件的名称，无后缀.txt
list_name = GetTxtName('/home/mayixuan/bytes-based/drift-after-matrix')



# 构建训练数据集和标签
# 构建训练集
train_data_source = []     # n*256*256
for fi in list_name[0:]:
    csv_name = 'drift-after-matrix/' + fi + '.csv'
    # ------------------------------------
    # show数组即一个文件的256*256的矩阵
    f = csv.reader(open(csv_name, 'r'))
    show = []
    for c in f:
        show.append(c)
    # -------------------------------------
    for m in range(len(show)):
        for n in range(len(show[m])):
            show[m][n] = float(show[m][n])
    show = (show - np.min(show)) / (np.max(show) - np.min(show)) * 255
    show = show.astype(np.int32)
    train_data_source.append(show)
print('数组形状', np.array(train_data_source).shape)
train_data = np.array(train_data_source)



# 构建训练集标签
with open('/home/mayixuan/drit-7-dataset/drift-labels.csv', 'r') as f:
    reader = csv.reader(f)
    name = [row[0] for row in reader]   #csv文件第一列,文件名称（去后缀）
    f.close()

with open('/home/mayixuan/drit-7-dataset/drift-labels.csv', 'r') as f:
    reader = csv.reader(f)
    label = [row[1] for row in reader]  #csv文件第2列，文件标签（所属家族）

# 读取 list_name 中的所有文件名，查看其对应标签，保存到train_label数组中
fileNum = 0
train_label = []
for fi in list_name[0:]:
    fileNum = fileNum + 1
    for i in range(len(name)): #如果这个图片和csv中某个名字对应，则将其对应标签保存到train_label中
        if (fi == name[i]):
#           print("两者相同 ",fi,label[i])
            train_label.append(int(label[i]))
            break
print("打标签的文件共 %d 个" %(fileNum))
print(train_label)



import PIL
import matplotlib.pyplot as pyplot


for i in range(len(train_label)):
       # scipy.misc.imsave('image//' + str(train_label[i]) + '//' + list_name[i] + '.jpg', train_data[i])
       scipy.misc.imsave('gray-image-after//' + str(train_label[i]) + '//' + list_name[i] + '.jpg', train_data[i])


print('Done!!')